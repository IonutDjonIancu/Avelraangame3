@model Duel

@* Townhall/DuelOf *@

<div class="row">
    <div class="col-8">
        <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">
            <button type="button" class="btn btn-outline-secondary">Duel</button>
            <button type="button" class="btn btn-outline-dark">Tournament</button>
            <button type="button" class="btn btn-outline-dark">Quest</button>
            <button type="button" class="btn btn-outline-dark">Tavern</button>
            <button type="button" class="btn btn-outline-dark">Market</button>
            <button type="button" class="btn btn-outline-dark">Mercs</button>
        </div>
    </div>
    <div class="col-4">
        <div id="spinner" class="spinner-grow text-secondary float-end" role="status" title="Loading...">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
</div>

<div class="container mt-3 footer-border">
    <div class="row mt-3" id="battlequeue">
        <div class="col col-12 d-flex justify-content-start">
            @foreach (var charId in Model.Battlequeue)
            {
                <img 
                    class="rounded-3 m-1 item-1" 
                    src="@Model.GoodGuys.Union(Model.BadGuys).ToList().Find(s => s.Identity.Id == charId)!.Details.Portrait" 
                    title="@Model.GoodGuys.Union(Model.BadGuys).ToList().Find(s => s.Identity.Id == charId)!.Details.Name" 
                    width="20" 
                    height="20" 
                />
            }
        </div>
    </div>
    <div class="row mt-3" id="resultboard">
        <input class="rounded-3 text-center resultboard" value="@Model.Resultboard"/>
    </div>
    <div class="mt-3" id="actions">
        <div class="dropdown d-flex justify-content-center">
            @* offensive actions *@
            <button class="btn btn-sm btn-outline-dark dropdown-toggle me-1" type="button" id="offensives" data-bs-toggle="dropdown" aria-expanded="false" style="background-color: black;">
                Offense
            </button>
            <ul class="dropdown-menu resultboard" aria-labelledby="offensives">
                <li><button onclick="attack()" class="dropdown-item primary-green" title="Try to attack target">Attack</button></li>
                <li><button class="dropdown-item primary-green" title="Try to spellcast the target">Arcane</button></li>
                <li><button class="dropdown-item primary-green" title="Try to wrestle the target">Wrestle</button></li>
            </ul>
            @* defensive actions *@
            <button class="btn btn-sm btn-outline-dark dropdown-toggle me-1" type="button" id="defensives" data-bs-toggle="dropdown" aria-expanded="false" style="background-color: black;">
                Defense
            </button>
            <ul class="dropdown-menu resultboard" aria-labelledby="defensives">
                <li><button onclick="attack()" class="dropdown-item primary-green" title="Try to attack target">Attack</button></li>
                <li><button class="dropdown-item primary-green" title="Try to spellcast the target">Arcane</button></li>
                <li><button class="dropdown-item primary-green" title="Try to wrestle the target">Wrestle</button></li>
            </ul>
            @* other actions *@
            <button type="button" class="btn btn-sm btn-outline-dark me-1">Let Ai act</button>
            <button type="button" class="btn btn-sm btn-outline-dark me-1">End round</button>
            <button onclick="hideActions()" title="hide actions" type="button" class="btn btn-sm btn-outline-dark actions secondary-darkred">&#10008;</button>
        </div>
    </div>
    <div class="row mt-3" id="battleboard"> 
        @* Characters *@
        <div class="col-6" id="characterArea">
            <div class="float-end d-flex">
                @foreach (var character in Model.GoodGuys)
                {
                    <div onclick="charSelect('@character.Identity.Id')" id="card-@character.Identity.Id" class="d-flex flex-column bd-highlight mb-3 pointer character">
                        <div class="align-self-center">
                            <img class="rounded-3 m-2 item-@character.Details.Entitylevel" src="@character.Details.Portrait" width="60" height="80" title="@character.Details.Name" />
                        </div>
                        <div>
                            <div class="px-2 text-center" style="font-size: small">
                                <span title="endurance" class="text-100">@character.Fights.Endurance</span> | <span title="actions">@character.Actuals.Actions</span> &#9830; <span title="defense">@character.Actuals.Defense</span>
                            </div>
                            <div class="px-2 text-center" style="font-size: small">
                                <span title="accretion" class="text-100-m">@character.Fights.Accretion</span> | <span title="resist">@character.Actuals.Resist</span> &#9824; <span style="font-size:x-small" title="specialization">@character.Details.Spec.Substring(0, 3)</span>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
        @* Npc *@
        <div class="col-6" id="npcArea">
            <div class="float-start d-flex">
                @foreach (var npc in Model.BadGuys)
                {
                    <div onclick="charSelect('@npc.Identity.Id')" id="card-@npc.Identity.Id" class="d-flex flex-column bd-highlight mb-3 pointer character">
                        <div class="align-self-center">
                            <img class="rounded-3 m-2 item-@npc.Details.Entitylevel" src="@npc.Details.Portrait" width="60" height="80" title="@npc.Details.Name" />
                        </div>
                        <div>
                            <div class="px-2 text-center" style="font-size: small">
                                <span title="endurance" class="text-100">@npc.Fights.Endurance</span> | <span title="actions">@npc.Actuals.Actions</span> &#9830; <span title="defense">@npc.Actuals.Defense</span>
                            </div>
                            <div class="px-2 text-center" style="font-size: small">
                                <span title="accretion" class="text-100-m">@npc.Fights.Accretion</span> | <span title="resist">@npc.Actuals.Resist</span> &#9824; <span style="font-size:x-small" title="specialization">@npc.Details.Spec.Substring(0, 3)</span>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<script>
   
    const attack = () => {
        location.reload();
    }

    const charSelect = (id) => {

        const selectedChar1 = "selectedChar1";
        const selectedChar2 = "selectedChar2";

        let char1 = localStorage.getItem(selectedChar1);
        let char2 = localStorage.getItem(selectedChar2);

        if (char1 && char2) {
            $(".character").removeClass("selected-character1");
            $(".character").removeClass("selected-character2");
            localStorage.removeItem(selectedChar1);
            localStorage.removeItem(selectedChar2);
        } else if (char1) {
            $("#card-" + id).addClass("selected-character2");
            localStorage.setItem(selectedChar2, id);
        } else {
            $("#card-" + id).addClass("selected-character1");
            localStorage.setItem(selectedChar1, id);
        }
    }

    const hideActions = () => {
        $("#actions").hide();
    }

    const hideLoading = () => {
        $(document).ready(() => {
            $("#spinner").hide(500);
        });

        localStorage.removeItem("selectedChar1");
        localStorage.removeItem("selectedChar2");

        console.log(@Html.Raw(Json.Serialize(Model)));
    }

    hideLoading();
</script>